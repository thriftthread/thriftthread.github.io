<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
        .login-section, .admin-section { display: none; }
        input, select, button { padding: 10px; margin: 5px 0; width: 100%; }
        button { background: #b38b59; color: white; border: none; cursor: pointer; }
        .request-details { margin: 20px 0; padding: 15px; background: #f5f5f5; }
    </style>
</head>
<body>
    <div id="loginSection" class="login-section">
        <h2>Admin Login</h2>
        <input type="password" id="adminPassword" placeholder="Enter Admin Password">
        <button onclick="login()">Login</button>
    </div>

    <div id="adminSection" class="admin-section">
        <h2>Update Request Status</h2>
        <input type="text" id="adminTrackingId" placeholder="Enter Tracking ID">
        <button onclick="fetchRequest()">Find Request</button>
        
        <div id="requestDetails" class="request-details" style="display: none;">
            <h3>Request Details</h3>
            <div id="requestData"></div>
            <select id="statusUpdate">
                <option value="Pending">Pending</option>
                <option value="Viewed">Viewed</option>
                <option value="Accepted">Accepted</option>
                <option value="Rejected">Rejected</option>
            </select>
            <button onclick="updateStatus()">Update Status</button>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
    <script>
        const firebaseConfig = { /* YOUR CONFIG HERE */ };
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Simple Password Protection (Replace with your password)
        const ADMIN_PASSWORD = "admin123"; 

        function login() {
            const password = document.getElementById('adminPassword').value;
            if (password === Vistorahaiye) {
                document.getElementById('loginSection').style.display = 'none';
                document.getElementById('adminSection').style.display = 'block';
            } else {
                alert("Incorrect password!");
            }
        }

        async function fetchRequest() {
            const trackingId = document.getElementById('adminTrackingId').value.trim().toUpperCase();
            if (!trackingId) return alert("Enter a Tracking ID.");

            const doc = await db.collection('requests').doc(trackingId).get();
            const requestDiv = document.getElementById('requestDetails');

            if (!doc.exists) {
                document.getElementById('requestData').innerHTML = "❌ Request not found.";
                requestDiv.style.display = 'block';
                return;
            }

            const data = doc.data();
            document.getElementById('requestData').innerHTML = `
                <strong>ID:</strong> ${data.trackingId}<br>
                <strong>Name:</strong> ${data.name}<br>
                <strong>Status:</strong> ${data.status}<br>
                <strong>Submitted:</strong> ${new Date(data.createdAt?.toDate()).toLocaleString()}<br>
                <strong>Image:</strong> ${data.imageUrl ? `<img src="${data.imageUrl}" style="max-width: 200px;">` : 'None'}
            `;
            document.getElementById('statusUpdate').value = data.status;
            requestDiv.style.display = 'block';
        }

        async function updateStatus() {
            const trackingId = document.getElementById('adminTrackingId').value.trim().toUpperCase();
            const newStatus = document.getElementById('statusUpdate').value;

            await db.collection('requests').doc(trackingId).update({ status: newStatus });
            alert("✅ Status updated!");
            fetchRequest(); // Refresh
        }
    </script>
</body>
</html>
